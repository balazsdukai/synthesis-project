The identification and visualizatio of indoor movement ins a procedoure that
requires various tools and steps. While some steps can be automated, others need
to be done manually. The detailed description of these steps follows.

\subsection{Delineation of building parts}
There are two factors that define what is considered a building part, the layout
of the builidn and the layout of hte access points. The layout of the
builidng defines the functional divisions, e.g. departements or common areas.
Additionally, it is necessary to have at least one access point in each of these
divisions, or preferably more access points equally distributed in the division.
Considering the signal range of an access point, it is not desirable to have
access points close to the boarder of two neighbouring divisions, as in that
case the user could be falsly located in the neighbour division if he is picked
up by the respective access point. The combination of a functional division and
the access points within define a building part.

In case of the Faculty of Architecture \autoref{figure:BK_sketch} displays the
provided access point map and the manually overlaid functional divisions, thus
defining the building parts.
% TODO: put the complete list of building parts in the appendix and reference it
% here

\begin{figure}[H]
\centering
\includegraphics[scale=0.8]{bk_BG_sketch.png}
\captionsetup{justification=centering}
\caption{Access point map where yellow dots mark the access points, and
the functional divisions (colored areas) on the ground floor at the Faculty of
Architecture.}
\label{figure:BK_sketch}
\end{figure}

\subsection{Movement between building parts}

XANDER? or MARTIJN?

described the `movements table here`

\subsection{Indoor route network}
The route network of the Faculty of Architecture where nodes represent building
parts and edges represent corridors was drawn manually in \textit{QGIS},
following the floorplan of the building. However, the resulting \textit{sphagetti network}
does not contain the toplogical relations that are required to calculate
a shortest route. Therefore the topological relationships were created with the
PostGIS extension \textit{pgRouting}. Using a databased-based solution for
storing the data, creating toplogy and calculate shortest routes allowed us to
easily match the movements, which were calculated in the database, to the route
network.

\subsection{Mapping traffic to the route network}
In the \textit{movements table} every record represent a single move of a person
from origin to destination. In order to display these movements, identical moves
that have the same origin-destination pair are aggregated, resulting in a table
of unique origin-destination pairs with the amount of related moves
\autoref{table:moves}.

\begin{table}[H]
\centering
\caption{Aggregated moves between building parts}
\label{table:moves}
\begin{tabular}{@{}lll@{}}
\toprule
Origin        & Destination & Count \\ \midrule
OTB           & Restaurant  & 126   \\
Main entrance & Espressobar & 543   \\ \bottomrule
\end{tabular}
\end{table}

Then the shortest route between each origin-destination pair is calculated and
the movement counts are added to each edge that is traversed in the network.
Thus if the shortest route of two distinct movements share edges, the movement
count is summed up on the common edges, resulting in the traffic load of a given
edge \autoref{table:moves}.

\begin{table}[H]
\centering
\caption{Traffic load on the indoor route network}
\label{table:traffic}
\begin{tabular}{@{}lll@{}}
\toprule
Edge ID & Traffic & Line width \\ \midrule
45      & 6151    & 1.10       \\
46      & 1994    & 0.64       \\ \bottomrule
\end{tabular}
\end{table}

% TODO: if we include code in the appendix, reference the function here

\subsection{Visualization of the movement}
The visualization method, as well as the route network, is two-dimensional.
However, three-dimensionality is imitated by using an \textit{exploded view}
common in architectural visualizations, that shifts overlapping elements (e.g.
floors) by a certain angle.\\
In this graphic the \textit{nodes} that represent the building parts are the approximate centroids of the polygonal area of the buildingpart. The nodes were manually adjusted
to better match the route network.\\
The route network is represented with
straigth lines, where the \textit{line width} is proportional to the traffic
load of a given edge. However, line widths cannot be compared across graphics, as in order
to facilitate consistent scale the line width variable is normalized to
the range of 0.5-5 units, regardless of traffic load. The range of 0.5-5 units
is choosen to provide a visually appealing and clear graphic. \textit{Colors}
mark the four separate floors and the staircases (grey) in the building.

